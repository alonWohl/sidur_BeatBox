const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/feature-schedule-Dt70VzOj.js","assets/vendor-react-nkjetNgR.js","assets/vendor-DVTe_ucZ.js","assets/index-B1GQdJTL.js","assets/core-Dbb0tnST.js","assets/components-4PBFGKa1.js","assets/vendor-dnd-CpawC7xN.js","assets/index-oW1FjmK-.css"])))=>i.map(i=>d[i]);
import{r as e,a as s,j as a,x as t,q as l,u as r,y as n,z as o,A as i}from"./vendor-react-nkjetNgR.js";import{S as c,f as d,g as m,h as u,i as x,I as h,B as p,L as f,P as y,j as g,k as j}from"./components-4PBFGKa1.js";import{a as v,b as w,c as b,d as N,u as C,r as E,e as I,f as S,g as k}from"./core-Dbb0tnST.js";import{_ as B}from"./index-B1GQdJTL.js";import{e as D}from"./vendor-DVTe_ucZ.js";import{E as A,S as _}from"./feature-schedule-Dt70VzOj.js";import{b as M,c as P,D as F,p as O,d as L,T as z,M as R}from"./vendor-dnd-CpawC7xN.js";function V(){const[r,n]=e.useState({username:"",password:""}),[o,i]=e.useState({username:"",password:""}),[f,y]=e.useState(!1),g=s();return a.jsx("div",{className:"h-full bg-gray-50 flex flex-col items-center p-4",children:a.jsxs("div",{className:"max-w-md w-full",children:[a.jsxs("div",{className:"text-center mb-8",children:[a.jsx(t,{className:"mx-auto h-12 w-12 text-red-600"}),a.jsx("h2",{className:"mt-6 text-3xl font-bold text-gray-900",children:"ברוכים הבאים"}),a.jsx("p",{className:"mt-2 text-sm text-gray-600",children:"התחבר כדי לנהל את המשמרות שלך"})]}),a.jsx("div",{className:"bg-white shadow-xl rounded-lg p-8",children:a.jsxs("form",{className:"space-y-6",onSubmit:async e=>{if(e.preventDefault(),(()=>{let e=!0;const s={username:"",password:""};return r.username||(s.username="חובה לבחור משתמש",e=!1),r.password?r.password.length<6&&(s.password="הסיסמא חייבת להכיל לפחות 6 תווים",e=!1):(s.password="חובה להזין סיסמא",e=!1),i(s),e})())try{y(!0),await v(r),l.success("התחברת בהצלחה"),g("/")}catch(s){l.error("שגיאה בהתחברות. נא לנסות שוב.")}finally{y(!1)}else l.error("נא למלא את כל השדות הנדרשים")},children:[a.jsxs("div",{className:"space-y-2",children:[a.jsx("label",{className:"text-sm font-medium text-gray-700 block",children:"בחר סניף"}),a.jsxs(c,{onValueChange:e=>{n({...r,username:e}),i((e=>({...e,username:""})))},value:r.username,name:"username",dir:"rtl",children:[a.jsx(d,{className:"w-full text-right "+(o.username?"border-red-500 focus:ring-red-500":"border-gray-300 focus:ring-red-500"),children:a.jsx(m,{placeholder:"בחר סניף"})}),a.jsxs(u,{className:"text-right",children:[a.jsx(x,{value:"moked",className:"text-right",children:"מוקד"}),a.jsx(x,{value:"tlv",className:"text-right",children:"תל אביב"}),a.jsx(x,{value:"pt",className:"text-right",children:"פתח תקווה"}),a.jsx(x,{value:"rishon",className:"text-right",children:"ראשון לציון"}),a.jsx(x,{value:"rosh",className:"text-right",children:"ראש העין"})]})]}),o.username&&a.jsx("p",{className:"text-red-500 text-xs mt-1",children:o.username})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsx("label",{className:"text-sm font-medium text-gray-700 block",children:"סיסמא"}),a.jsx(h,{type:"password",placeholder:"הזן סיסמא",onChange:e=>{const{name:s,value:a}=e.target;n({...r,[s]:a}),i((e=>({...e,[s]:""})))},value:r.password,name:"password",className:"w-full "+(o.password?"border-red-500 focus:ring-red-500":"border-gray-300 focus:ring-red-500")}),o.password&&a.jsx("p",{className:"text-red-500 text-xs mt-1",children:o.password})]}),a.jsx(p,{type:"submit",disabled:f,className:"w-full bg-[#BE202E] cursor-pointer hover:bg-red-700 text-white py-2 px-4 rounded-md transition-colors duration-200 disabled:opacity-50 disabled:cursor-not-allowed",children:f?a.jsxs("div",{className:"flex items-center justify-center",children:[a.jsx("div",{className:"w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin mr-2"}),"מתחבר..."]}):"התחבר"})]})})]})})}const J=["#FF3366","#FF6B2B","#4834DF","#2ECC71","#9B59B6","#E74C3C","#1ABC9C","#F39C12","#3498DB","#D35400","#8E44AD","#16A085","#C0392B","#2980B9","#E67E22","#27AE60","#E84393","#00B894","#6C5CE7","#00CEC9"],T=({value:s,onChange:t})=>{const[l,r]=e.useState(!1);return a.jsx("div",{className:"flex flex-col gap-2",children:a.jsxs(y,{open:l,onOpenChange:r,children:[a.jsx(g,{asChild:!0,children:a.jsx("button",{type:"button",className:"flex items-center gap-2 p-1.5 sm:p-2 border rounded-md hover:bg-gray-50 w-full",children:a.jsx("div",{className:"w-full h-5 min-w-5 sm:w-6 sm:h-6 rounded-sm border",style:{backgroundColor:s}})})}),a.jsx(j,{className:"w-[200px] sm:w-[232px] p-2 sm:p-3",children:a.jsx("div",{className:"grid grid-cols-5 sm:grid-cols-4 gap-1.5 sm:gap-2",children:J.map((e=>a.jsx("button",{onClick:()=>{t({target:{name:"color",value:e}}),r(!1)},className:`w-8 h-8 sm:w-12 sm:h-12 rounded-lg transition-transform hover:scale-110 focus:outline-none focus:ring-2 focus:ring-offset-2 ${s===e}`,style:{backgroundColor:e},type:"button","aria-label":`Select color ${e}`},e)))})})]})})};function $(){const{user:s}=r((e=>e.userModule)),[t,l]=e.useState({name:"",color:"",branch:null==s?void 0:s.name}),i=r((e=>e.employeeModule.employees)),{isLoading:y}=r((e=>e.systemModule)),{filterBy:g}=r((e=>e.systemModule));e.useEffect((()=>{w({name:null==s?void 0:s.name})}),[s]),e.useEffect((()=>{b(g)}),[g]);const j=e=>{const{name:s,value:a}=e.target;l({...t,[s]:a})};return a.jsxs("div",{className:"flex flex-col h-full items-center p-4",children:[y&&a.jsx(f,{}),a.jsxs("form",{className:"flex flex-col items-center gap-2 mt-8 sm:mt-16 w-full max-w-md",onSubmit:async e=>{var s,a;if(e.preventDefault(),t.name.length<2)o.error("שם העובד חייב להכיל לפחות 2 תווים");else if(i.some((e=>e.name===t.name)))o.error("שם העובד כבר קיים");else try{await N(t),l({name:"",color:"",branch:""}),o.success("עובד נוסף בהצלחה")}catch(r){const e=(null==(a=null==(s=r.response)?void 0:s.data)?void 0:a.err)||r.message||"שגיאה בהוספת עובד";o.error(e)}},children:[a.jsx("h2",{className:"text-lg sm:text-xl font-semibold",children:"הוסף עובד"}),a.jsxs("div",{className:"flex flex-col sm:flex-row items-stretch sm:items-center gap-2 mt-2 sm:mt-4 w-full",children:[a.jsx(h,{type:"text",placeholder:"שם",name:"name",value:t.name,onChange:j,className:"text-sm sm:text-base",tabIndex:1,autoFocus:!0}),a.jsx(T,{value:t.color,onChange:j}),(null==s?void 0:s.isAdmin)&&a.jsxs(c,{name:"branch",value:t.branch,onValueChange:e=>{l({...t,branch:e})},className:"w-full sm:w-auto",children:[a.jsx(d,{className:"text-sm sm:text-base",children:a.jsx(m,{placeholder:"בחר סניף"})}),a.jsxs(u,{children:[a.jsx(x,{value:"מוקד",children:"מוקד"}),a.jsx(x,{value:"תל אביב",children:"תל אביב"}),a.jsx(x,{value:"פתח תקווה",children:"פתח תקווה"}),a.jsx(x,{value:"רשאון לציון",children:"רשאון לציון"}),a.jsx(x,{value:"ראש העין",children:"ראש העין"})]})]}),a.jsx(p,{className:"w-full sm:w-auto text-sm sm:text-base",children:"הוסף"})]})]}),a.jsxs("ul",{className:"grid grid-cols-2  sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-6 gap-3 sm:gap-4 container mt-8 sm:mt-16 w-full max-w-6xl",children:[0===i.length&&a.jsx("li",{className:"text-center text-gray-500 col-span-full text-sm sm:text-base",children:"אין עובדים"}),i.map((e=>a.jsxs("li",{className:"flex flex-col p-3 sm:p-4 gap-2 sm:gap-3 bg-white rounded-lg shadow-sm border",children:[a.jsx("h2",{className:"text-sm sm:text-md font-bold truncate",style:{color:e.color},children:e.name}),a.jsxs("p",{className:"text-xs sm:text-sm text-gray-500",children:["סניף: ",e.branch]}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("p",{className:"text-xs sm:text-sm text-gray-500",children:"צבע"}),a.jsx(T,{value:e.color,onChange:s=>(async(e,s)=>{var a,t;const l={...s,color:e.target.value};try{await C(l)}catch(r){const e=(null==(t=null==(a=r.response)?void 0:a.data)?void 0:t.err)||r.message||"שגיאה בעדכון עובד";o.error(e)}})(s,e)})]}),a.jsxs(p,{onClick:()=>{return s=e.id,void E(s);var s},className:"text-xs sm:text-sm mt-auto",variant:"destructive",children:["הסר",a.jsx(n,{className:"w-4 h-4"})]})]},e.id)))]})]})}function q(){const{user:s}=r((e=>e.userModule)),{filterBy:t,isLoading:n}=r((e=>e.systemModule)),{schedules:o}=r((e=>e.scheduleModule)),{employees:h}=r((e=>e.employeeModule)),[y,g]=e.useState(!1),[j,v]=e.useState(null),[N,C]=e.useState(null),[E,V]=e.useState(null),J=e.lazy((()=>B((()=>import("./feature-schedule-Dt70VzOj.js").then((e=>e.T))),__vite__mapDeps([0,1,2,3,4,5,6,7])))),T=e.lazy((()=>B((()=>import("./feature-schedule-Dt70VzOj.js").then((e=>e.a))),__vite__mapDeps([0,1,2,3,4,5,6,7])))),$=M(P(R),P(z,{activationConstraint:{delay:200,tolerance:5}}));e.useEffect((()=>{I(t),b(t),v(null)}),[t]),e.useEffect((()=>{o&&(null==h?void 0:h.length)>0&&v({...o})}),[o,h]);const q=async(e,s,a,t,r)=>{if(null==e?void 0:e.id)try{const l=JSON.parse(JSON.stringify(e)),n=parseInt(r);let o=l.days.findIndex((e=>e.name===a));if(-1===o&&(l.days.push({name:a,shifts:[]}),o=l.days.length-1),l.days[o].shifts||(l.days[o].shifts=[]),"move"===(null==s?void 0:s.type)){const{sourceDay:e,sourceRole:a,sourcePosition:r,employeeId:i}=s,c=l.days.findIndex((s=>s.name===e));if(-1===c)return;const d=l.days[o].shifts.find((e=>e.role===t&&e.position===n));l.days[c].shifts=l.days[c].shifts.filter((e=>!(e.role===a&&e.position===r))),l.days[o].shifts=l.days[o].shifts.filter((e=>!(e.role===t&&e.position===n))),l.days[o].shifts.push({role:t,position:n,employeeId:i}),d&&l.days[c].shifts.push({role:a,position:r,employeeId:d.employeeId})}else l.days[o].shifts=l.days[o].shifts.filter((e=>!(e.role===t&&e.position===n))),s&&"undefined"!==s&&l.days[o].shifts.push({role:t,position:n,employeeId:s});await k(l),v({...l})}catch(n){l.error("שגיאה בעדכון המשמרת")}};return s?a.jsx(F,{sensors:$,onDragStart:e=>{var s,a;const{active:t}=e;C(t.id),("employee"===(null==(s=t.data.current)?void 0:s.type)||"tableCell"===(null==(a=t.data.current)?void 0:a.type))&&V(t.data.current.employee)},onDragEnd:e=>{var s,a;const{active:t,over:r}=e;if(r&&j){try{if("employee"===(null==(s=t.data.current)?void 0:s.type)){const[e,s,a]=r.id.split("-");q(j,t.id,e,s,parseInt(a))}else if("tableCell"===(null==(a=t.data.current)?void 0:a.type)){const[e,s,a]=t.data.current.cellId.split("-"),[l,n,o]=r.id.split("-"),i={type:"move",sourceDay:e,sourceRole:s,sourcePosition:parseInt(a),employeeId:t.data.current.employee.id};q(j,i,l,n,parseInt(o))}}catch(n){l.error("שגיאה בעדכון המשמרת")}C(null),V(null)}},collisionDetection:O,children:a.jsxs("div",{className:"flex flex-col h-full w-full animate-in fade-in duration-300 px-4 space-y-6 max-w-[1600px] mx-auto",children:[n&&a.jsx(f,{}),a.jsx("h1",{className:"text-3xl text-center font-semibold  text-zinc-800 my-4",children:"סידור עבודה"}),a.jsx(J,{className:"absolute top-10 right-10 opacity-50 hidden max-w-[300px] max-h-[300px] 2xl:block"}),a.jsx(T,{className:"absolute bottom-10 left-10 opacity-50 hidden max-w-[300px] max-h-[300px] md:block md:max-w-[200px] md:max-h-[200px]"}),a.jsxs("div",{className:"flex gap-2 items-center justify-between w-full",children:[s.isAdmin&&a.jsxs(c,{onValueChange:e=>w({...t,name:e}),value:t.name,className:"w-full sm:w-auto",children:[a.jsx(d,{className:"h-8 sm:h-10 text-sm sm:text-base justify-self-start",children:a.jsx(m,{placeholder:"בחר סניף"})}),a.jsx(u,{children:["מוקד","תל אביב","פתח תקווה","רשאון לציון","ראש העין"].map((e=>a.jsx(x,{value:e,children:e},e)))})]}),a.jsxs("div",{className:"flex gap-2",children:[a.jsx(p,{onClick:()=>(async e=>{if(e)try{const s={...e,days:e.days.map((e=>({...e,shifts:[]})))};await S(s),l.success("הסידור נוקה בהצלחה")}catch{l.error("שגיאה בניקוי הסידור")}})(o),className:"cursor-pointer hover:bg-[#BE202E] hover:text-white h-8 sm:h-10 text-sm sm:text-base px-2 sm:px-4",variant:"outline",children:"נקה סידור"}),a.jsxs(p,{onClick:async()=>{g(!0);try{const e=document.getElementById("schedule-table-for-share"),s=await D.toPng(e);if(/iPhone|iPad|iPod|Android/i.test(navigator.userAgent)){const e=await fetch(s),a=await e.blob(),t=new File([a],"schedule.png",{type:"image/png"});if(navigator.share)await navigator.share({files:[t],title:"סידור עבודה שבועי",text:"סידור עבודה שבועי"});else{const e="whatsapp://send?text=סידור עבודה שבועי";window.location.href=e;const a=document.createElement("a");a.href=s,a.download="schedule.png",a.click()}}else{const e=document.createElement("a");e.href=s,e.download="schedule.png",e.click(),window.open("https://web.whatsapp.com","_blank")}}catch(e){l.error("שגיאה בשיתוף")}finally{g(!1)}},disabled:y,className:" bg-green-500 hover:bg-green-600 h-8 sm:h-10 text-sm sm:text-base px-2 sm:px-4  ",children:[y?a.jsx("span",{className:"animate-spin",children:"⏳"}):a.jsx(i,{className:"w-3 h-3 sm:w-4 sm:h-4"}),a.jsx("span",{className:"whitespace-nowrap",children:y?"מכין...":"שתף"})]})]})]}),a.jsx(A,{employees:h}),a.jsx("div",{className:"overflow-auto touch-pan-x touch-pan-y",children:a.jsx("div",{className:"min-w-[640px]",children:a.jsx(_,{type:t.name,currentSchedule:j,getAssignedEmployee:(e,s,a,t)=>{if(!(null==e?void 0:e.days))return null;const l=e.days.find((e=>e.name===s));if(!(null==l?void 0:l.shifts))return null;const r=l.shifts.find((e=>e.role===a&&e.position===parseInt(t)));return(null==r?void 0:r.employeeId)?h.find((e=>e.id===r.employeeId)):null},handleRemoveEmployee:async(e,s,a,t)=>{if(null==e?void 0:e.id)try{const l=JSON.parse(JSON.stringify(e)),r=l.days.find((e=>e.name===s));if(!r)return;r.shifts=r.shifts.filter((e=>!(e.role===a&&e.position===t))),await k(l),v(l)}catch(r){l.error("שגיאה בהסרת העובד")}}})})}),a.jsx(L,{dropAnimation:{duration:200,easing:"cubic-bezier(0.18, 0.67, 0.6, 1.22)"},children:E&&a.jsx("div",{className:"h-8 w-[80px] flex items-center justify-center text-white rounded-sm shadow-lg",style:{backgroundColor:E.color,transform:"scale(1.05)"},children:E.name})})]})}):a.jsx("div",{className:"flex justify-center items-center h-96 animate-in fade-in duration-500",children:a.jsx("div",{className:"text-center text-gray-500",children:a.jsx("p",{className:"text-lg font-medium",children:"אנא התחבר כדי להציג את הסידור"})})})}export{$ as E,V as L,q as S};
